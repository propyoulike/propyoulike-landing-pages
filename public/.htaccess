# ----------------------------------------
# CRITICAL: disable BigRock custom 404 override
# ----------------------------------------
ErrorDocument 404 default

# ----------------------------------------
# Correct MIME types (manifest)
# ----------------------------------------
<IfModule mod_mime.c>
  AddType application/manifest+json .webmanifest
  AddType application/manifest+json .json
</IfModule>

<IfModule mod_rewrite.c>
  RewriteEngine On

  # ----------------------------------------
  # NEVER rewrite critical static files
  # ----------------------------------------
  RewriteRule ^site\.webmanifest$ - [L]
  RewriteRule ^manifest\.json$ - [L]
  RewriteRule ^robots\.txt$ - [L]
  RewriteRule ^sitemap\.xml$ - [L]
  RewriteRule ^favicon\.ico$ - [L]

  # ----------------------------------------
  # FORCE trailing slash for directories
  # /provident → /provident/
  # ----------------------------------------
  RewriteCond %{REQUEST_FILENAME} -d
  RewriteRule ^(.+[^/])$ /$1/ [R=301,L]

  # ----------------------------------------
  # Allow real files (JS, CSS, images, etc.)
  # ----------------------------------------
  RewriteCond %{REQUEST_FILENAME} -f
  RewriteRule . - [L]

  # ----------------------------------------
  # Serve static project & builder pages
  # /slug/ → /slug/index.html
  # ----------------------------------------
  RewriteCond %{REQUEST_FILENAME} -d
  RewriteCond %{REQUEST_FILENAME}/index.html -f
  RewriteRule ^(.+)$ $1/index.html [L]

  # ----------------------------------------
  # SPA fallback — HOMEPAGE ONLY
  # ----------------------------------------
  RewriteRule ^$ /index.html [L]

</IfModule>
